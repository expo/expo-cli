{"version":3,"file":"Diagnosis.js","sourceRoot":"","sources":["../../src/utils/Diagnosis.ts"],"names":[],"mappings":"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","sourcesContent":["import chalk from 'chalk';\nimport diff from 'deep-diff';\nimport { ensurePWAConfig, readConfigJson } from '@expo/config';\nimport fs from 'fs';\nimport getPathsAsync from './getPathsAsync';\nimport { DevConfiguration, Environment, FilePaths } from '../types';\n\n// https://stackoverflow.com/a/51319962/4047926\nfunction colorizeKeys(json: { [key: string]: any } | string) {\n  if (typeof json !== 'string') {\n    json = JSON.stringify(json, undefined, 2);\n  }\n  return json.replace(\n    /(\"(\\\\u[a-zA-Z0-9]{4}|\\\\[^u]|[^\\\\\"])*\"(\\s*:)?|\\b(true|false|null)\\b|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)/g,\n    function(match) {\n      if (/--pop/.test(match)) {\n        // Bacon: If a key is prefixed with --pop it'll be colored red\n        return chalk.red.bold(match.substring(0, match.length - 7) + '\":');\n      } else if (/--push/.test(match)) {\n        // Bacon: If a key is prefixed with --push it'll be colored green\n        return chalk.green.bold(match.substring(0, match.length - 8) + '\":');\n      } else if (/^\"/.test(match)) {\n        if (/:$/.test(match)) {\n          return chalk.magenta(match);\n        } else {\n          return chalk.blueBright(match);\n        }\n      } else if (/true|false/.test(match)) {\n        return chalk.cyanBright(match);\n      } else if (/null/.test(match)) {\n        return chalk.cyan(match);\n      }\n      return chalk.green(match);\n    }\n  );\n}\n\nfunction logHeader(title: string): void {\n  console.log(\n    chalk.hidden('<details><summary>\\n') +\n      chalk.bgGreen.black(`[${title}]\\n`) +\n      chalk.hidden('</summary>\\n')\n  );\n}\nfunction logMdHelper(...messages: any[]): void {\n  console.log(chalk.hidden(...messages));\n}\n\nfunction logFooter(): void {\n  logMdHelper('</details>');\n}\n\n// Log the main risky parts of webpack.config\nfunction logWebpackConfigComponents(webpackConfig: DevConfiguration) {\n  logHeader('Webpack Info');\n  const {\n    mode,\n    resolve: { alias = {} } = {},\n    entry,\n    devtool,\n    context,\n    devServer: { https, hot, contentBase } = {} as any,\n  } = webpackConfig;\n\n  // console.log('WEBPACK', JSON.stringify(webpackConfig, null, 2));\n  logMdHelper('```json');\n  console.log(\n    colorizeKeys({\n      mode,\n      devtool,\n      entry,\n      context,\n      https,\n      hot,\n      contentBase,\n      alias,\n    })\n  );\n  logMdHelper('```');\n  logFooter();\n}\n\nasync function logStaticsAsync(env: Environment) {\n  logHeader('Statics Info');\n\n  const paths = await getPathsAsync(env);\n\n  // Detect if the default template files aren't being used.\n  const { template: statics = {} as any } = paths;\n\n  const expectedLocation = 'webpack-config/web-default/';\n\n  for (const key of Object.keys(statics)) {\n    const filePath = statics[key];\n    if (typeof filePath !== 'string') continue;\n    const fileName = filePath.substring(filePath.lastIndexOf('/') + 1);\n    let message = chalk.reset(`- **${key}**: `) + chalk.blue(`\\`${fileName}\\``) + ' : ';\n    if (filePath.includes(expectedLocation)) {\n      message += chalk.bgGreen.black(`\\`${filePath}\\``);\n    } else {\n      message += chalk.bgRed.black(`\\`${filePath}\\``);\n    }\n    console.log(message);\n  }\n\n  logFooter();\n}\n\nfunction logEnvironment({ config, ...env }: Environment) {\n  logHeader('Environment Info');\n  logMdHelper('```json');\n  console.log(colorizeKeys(env));\n  logMdHelper('```');\n  logFooter();\n}\n\nfunction setDeepValue(pathComponents: string[], object: { [key: string]: any }, value: any): void {\n  if (!pathComponents.length) {\n    return;\n  }\n  const key = pathComponents.shift();\n  if (!key) return;\n  if (!(key in object)) {\n    if (pathComponents.length) object[key] = {};\n    else {\n      if (value.kind === 'N') {\n        object[key] = value.lhs;\n      } else {\n        if ('rhs' in value) object[`${key}--push`] = value.rhs;\n        if ('lhs' in value) object[`${key}--pop`] = value.lhs;\n      }\n    }\n  }\n  setDeepValue(pathComponents, object[key], value);\n}\n\nasync function logAutoConfigValuesAsync(env: Environment) {\n  const locations = await getPathsAsync(env);\n\n  const config = readConfigJson(env.projectRoot);\n\n  const standardConfig = ensurePWAConfig({}, locations.absolute, {\n    templateIcon: locations.template.get('icon.png'),\n  });\n  const pwaConfig = ensurePWAConfig(config, locations.absolute, {\n    templateIcon: locations.template.get('icon.png'),\n  });\n\n  // @ts-ignore\n  const nonStandard = diff(standardConfig, pwaConfig);\n\n  let obj = {};\n\n  for (const diff of nonStandard) {\n    // console.log(chalk.bold(diff.path.join('/') + ': ') + chalk.bgRed(JSON.stringify(diff.rhs, null, 2)));\n\n    // TODO: Bacon: add support for array updates: https://www.npmjs.com/package/deep-diff#differences\n    if (diff.kind !== 'A') {\n      setDeepValue(diff.path, obj, diff);\n    }\n  }\n\n  logHeader('App.json');\n  logMdHelper('```json');\n  // TODO: Bacon: Diff block\n  console.log(colorizeKeys(obj));\n  logMdHelper('```');\n  logFooter();\n}\n\nasync function reportAsync(webpackConfig: DevConfiguration, env: Environment) {\n  console.log(chalk.bold('\\n\\nStart Copy\\n\\n'));\n\n  logWebpackConfigComponents(webpackConfig);\n  logEnvironment(env);\n  await logStaticsAsync(env);\n  await logAutoConfigValuesAsync(env);\n\n  const locations = await getPathsAsync(env);\n\n  await testBabelPreset(locations);\n\n  console.log(chalk.bold('\\nEnd Copy\\n\\n'));\n}\n\nasync function testBabelPreset(locations: FilePaths) {\n  logHeader('Babel Preset');\n\n  const babelrc = locations.absolute('.babelrc');\n  const babelConfig = locations.absolute('babel.config.js');\n\n  const printPassed = (message: string, ...messages: any[]) =>\n    console.log(chalk.bgGreen.black(`- [✔︎ ${message}]`, ...messages));\n  const printWarning = (message: string, ...messages: any[]) =>\n    console.log(chalk.bgYellow.black(`- [${message}]`, ...messages));\n  const printFailed = (message: string, ...messages: any[]) =>\n    console.log(chalk.bgRed.black(`- [x ${message}]`, ...messages));\n\n  if (fs.existsSync(babelrc)) {\n    printFailed(\n      'Using `.babelrc`',\n      'Please upgrade to Babel 7, and replace `.babelrc` with `babel.config.js`'\n    );\n  } else {\n    printPassed('Not using .babelrc', 'Expo web runs best with Babel 7+');\n  }\n\n  const printFailedToParse = (...messages: any[]) =>\n    printWarning(`Expo CLI cannot parse your babel.config.js at ${babelConfig}.`, ...messages);\n\n  function testBabelConfig(config: any, isFunction?: any) {\n    const preferred =\n      'It should be returning an object with `{ \"presets: [\"babel-preset-expo\"]\" }`.';\n    if (!config) {\n      if (isFunction) {\n        printWarning(\n          '`babel.config.js` is exporting a function that evaluates to a null object',\n          preferred\n        );\n      } else {\n        printWarning('`babel.config.js` is exporting a `null` object', preferred);\n      }\n      return;\n    } else if (!Array.isArray(config.presets)) {\n      const missingKey = ' without the \"presets\" key';\n      if (isFunction) {\n        printWarning(\n          '`babel.config.js` is exporting a function that evaluates to an object' + missingKey,\n          preferred\n        );\n      } else {\n        printWarning('`babel.config.js` is exporting an object' + missingKey, preferred);\n      }\n      return;\n    }\n\n    const isExpo = (preset: string) => preset === 'expo' || preset === 'babel-preset-expo';\n    const hasExpoPreset = (() => {\n      for (const preset of config.presets) {\n        if (\n          (typeof preset === 'string' && isExpo(preset)) ||\n          (Array.isArray(preset) && isExpo(preset[0]))\n        ) {\n          return true;\n        }\n      }\n      return false;\n    })();\n\n    if (hasExpoPreset) {\n      printPassed('Using `babel-preset-expo`', 'Tree-shaking should work as expected.');\n    } else {\n      printWarning(\n        'Not using `babel-preset-expo`',\n        `This is highly recommended as it'll greatly improve tree-shaking in most cases.`,\n        `\\nRun \\`yarn add babel-preset-expo\\` and add it to the \"presets\" array of your \\`babel.config.js\\`.`\n      );\n    }\n  }\n\n  if (fs.existsSync(babelConfig)) {\n    const configObjectOrFunction = require(require.resolve(babelConfig));\n\n    if (isFunction(configObjectOrFunction)) {\n      try {\n        const results = await configObjectOrFunction({ cache() {} });\n        testBabelConfig(results, true);\n      } catch (error) {\n        printFailedToParse(\n          `Is it exporting something other than an object or function?`,\n          `If it's exporting a function ensure that function returns a valid object containing the \"presets\" key.`,\n          `If it's exporting an object ensure it contains the \"presets\" key.`\n        );\n      }\n    } else {\n      testBabelConfig(configObjectOrFunction);\n    }\n  }\n  logFooter();\n}\n\nfunction isFunction(functionToCheck: any): boolean {\n  return functionToCheck && {}.toString.call(functionToCheck) === '[object Function]';\n}\n\nmodule.exports = {\n  reportAsync,\n};\n"]}