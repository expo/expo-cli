{"version":3,"file":"getPathsAsync.js","sourceRoot":"","sources":["../../src/utils/getPathsAsync.ts"],"names":[],"mappings":"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","sourcesContent":["import ConfigUtils from '@expo/config';\nimport findWorkspaceRoot from 'find-yarn-workspace-root';\nimport fs from 'fs';\nimport path from 'path';\nimport url from 'url';\n\nimport { FilePaths } from '../types';\n\nconst possibleMainFiles = [\n  'index.web.ts',\n  'index.ts',\n  'index.web.tsx',\n  'index.tsx',\n  'src/index.web.ts',\n  'src/index.ts',\n  'src/index.web.tsx',\n  'src/index.tsx',\n  'index.web.js',\n  'index.js',\n  'index.web.jsx',\n  'index.jsx',\n  'src/index.web.js',\n  'src/index.js',\n  'src/index.web.jsx',\n  'src/index.jsx',\n];\n\nfunction ensureSlash(inputPath: string, needsSlash: boolean): string {\n  const hasSlash = inputPath.endsWith('/');\n  if (hasSlash && !needsSlash) {\n    return inputPath.substr(0, inputPath.length - 1);\n  } else if (!hasSlash && needsSlash) {\n    return `${inputPath}/`;\n  } else {\n    return inputPath;\n  }\n}\n\nexport default async function getPathsAsync({\n  locations,\n  projectRoot,\n}: {\n  projectRoot?: string;\n  locations?: FilePaths;\n} = {}): Promise<FilePaths> {\n  // Recycle locations\n  if (locations) {\n    return locations;\n  }\n\n  const envPublicUrl = process.env.WEB_PUBLIC_URL;\n  const appDirectory = fs.realpathSync(process.cwd());\n\n  const inputProjectRoot = projectRoot || appDirectory;\n\n  function absolute(...pathComponents: string[]) {\n    // Simple check if we are dealing with an URL\n    if (pathComponents && pathComponents.length === 1 && pathComponents[0].startsWith('http')) {\n      return pathComponents[0];\n    }\n\n    return path.resolve(inputProjectRoot, ...pathComponents);\n  }\n\n  const absoluteProjectRoot = absolute();\n\n  function findMainFile() {\n    for (const fileName of possibleMainFiles) {\n      const filePath = absolute(fileName);\n      if (fs.existsSync(filePath)) {\n        return filePath;\n      }\n    }\n    return null;\n  }\n\n  function getModulesPath() {\n    const workspaceRoot = findWorkspaceRoot(absoluteProjectRoot); // Absolute path or null\n    if (workspaceRoot) {\n      return path.resolve(workspaceRoot, 'node_modules');\n    } else {\n      return absolute('node_modules');\n    }\n  }\n\n  const { exp: nativeAppManifest, pkg } = await ConfigUtils.readConfigJsonAsync(inputProjectRoot);\n\n  const packageJsonPath = absolute('package.json');\n  const modulesPath = getModulesPath();\n\n  /**\n   *  The main file is resolved like so:\n   * * `app.json` -> `expo.entryPoint`\n   * * `package.json` -> `\"main\"`\n   * * `possibleMainFiles`\n   */\n  let appMain;\n  if (nativeAppManifest.entryPoint) {\n    appMain = nativeAppManifest.entryPoint;\n  } else {\n    const { main } = pkg;\n    if (!main) {\n      // Adds support for create-react-app (src/index.js) and react-native-cli (index.js) which don't define a main.\n      appMain = findMainFile();\n      if (!appMain) {\n        throw new Error(\n          'Could not determine the main file in your project (index, src/index). Please define it with the `main` field in your `package.json`'\n        );\n      }\n    } else {\n      appMain = main;\n    }\n  }\n\n  const getPublicUrl = (appPackageJson: string) => envPublicUrl || require(appPackageJson).homepage;\n  // We use `WEB_PUBLIC_URL` environment variable or \"homepage\" field to infer\n  // \"public path\" at which the app is served.\n  // Webpack needs to know it to put the right <script> hrefs into HTML even in\n  // single-page apps that may serve index.html for nested URLs like /todos/42.\n  // We can't use a relative path in HTML because we don't want to load something\n  // like /todos/42/static/js/bundle.7289d.js. We have to know the root.\n  function getServedPath(appPackageJson: string): string {\n    const publicUrl = getPublicUrl(appPackageJson);\n    const servedUrl = envPublicUrl || (publicUrl ? url.parse(publicUrl).pathname : '/');\n    return ensureSlash(servedUrl, true);\n  }\n\n  const config = ConfigUtils.ensurePWAConfig(nativeAppManifest, absolute, {\n    templateIcon: templatePath('icon.png'),\n  });\n\n  const productionPath = absolute(config.web.build.output);\n\n  function templatePath(filename: string = ''): string {\n    const overridePath = absolute('web', filename);\n    if (fs.existsSync(overridePath)) {\n      return overridePath;\n    }\n    return path.join(__dirname, '../../web-default', filename);\n  }\n\n  function getProductionPath(...props: string[]): string {\n    return path.resolve(productionPath, ...props);\n  }\n\n  function getIncludeModule(...props: string[]): string {\n    return path.resolve(modulesPath, ...props);\n  }\n\n  return {\n    absolute,\n    includeModule: getIncludeModule,\n    packageJson: packageJsonPath,\n    root: absoluteProjectRoot,\n    appMain: absolute(appMain),\n    modules: modulesPath,\n    servedPath: getServedPath(absolute('package.json')),\n    template: {\n      get: templatePath,\n      folder: templatePath(),\n      indexHtml: templatePath('index.html'),\n      manifest: templatePath('manifest.json'),\n      serveJson: templatePath('serve.json'),\n      favicon: templatePath('favicon.ico'),\n    },\n    production: {\n      get: getProductionPath,\n      folder: getProductionPath(),\n      indexHtml: getProductionPath('index.html'),\n      manifest: getProductionPath('manifest.json'),\n      serveJson: getProductionPath('serve.json'),\n      favicon: getProductionPath('favicon.ico'),\n    },\n  };\n}\n"]}